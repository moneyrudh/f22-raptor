    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8" />
        <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <title>F-22 Game</title>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
        href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap"
        rel="stylesheet"
        />
        <style>
        body {
            margin: 0;
            background-color: #1a1a1a;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .canvas-container {
            position: relative;
            width: fit-content;
            height: fit-content;
        }
        canvas {
            background-color: #000;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            outline: 2px solid rgb(247, 247, 247);
        }
        #textCanvas {
            position: absolute;
            right: 2px;
            top: 2px;
            background-color: transparent;
            background: transparent;
            border: none;
            box-shadow: none;
            pointer-events: none;
            outline: none;
        }
        #startTextCanvas {
            position: absolute;
            right: 2px;
            top: 40%;
            background-color: transparent;
            pointer-events: none;
            outline: none;
        }
        #controls {
            bottom: 40px;
            color: white;
            font-family: "Press Start 2P", monospace;
            font-size: 15px;
            font-weight: 300;
            text-align: center;
            width: 50%;
        }
        #controls,
        .sound-controls {
            position: fixed;
            bottom: 40px;
        }
        #submit-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Slightly above center */
            width: 1300px;
            height: 796px;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: "Press Start 2P", monospace;
        }

        #submit-modal.hidden {
            display: none;
        }

        #username-input {
            width: 300px;
            padding: 12px;
            background: #000;
            border: 2px solid #fff;
            color: #fff;
            font-family: "Press Start 2P", monospace;
            font-size: 16px;
            text-align: center;
            margin-bottom: 20px;
            outline: none;
        }

        .button-container {
            display: flex;
            gap: 12px;
            width: 300px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            font-family: "Press Start 2P", monospace;
            font-size: 14px;
            border: none;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .modal-btn:hover {
            opacity: 0.9;
        }

        .no-btn {
            background: #fff;
            color: #000;
            border-radius: 2px;
        }

        .submit-btn {
            background: #ff3e3e;
            color: #fff;
            border-radius: 2px;
        }

        .score-display {
            margin-bottom: 32px;
            text-align: center;
        }

        .score-label {
            font-size: 32px;
            color: #fff;
            margin-bottom: 8px;
        }

        .score-value {
            font-size: 60px;
            color: #fff;
        }

        #game-header {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            width: 1300px;
            margin: auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: "Press Start 2P", monospace;
            pointer-events: none;
        }

        .title {
            color: white;
            font-size: 36px;
            margin-left: 0;
        }

        .credit {
            color: white;
            font-size: 14px;
            margin-right: 0;
        }

        .credit a {
            color: #ff3e3e;
            text-decoration: none;
            pointer-events: all;
        }

        .credit a:hover {
            text-decoration: underline;
        }

        #success-message {
            margin-top: 16px;
            color: #50cb13;
            text-align: center;
        }

        #error-message {
            margin-top: 16px;
            color: #ff3e3e;
            font-size: 12px;
            text-align: center;
        }

        #error-message.hidden {
            display: none;
        }

        #normal-message {
            display: none;
        }

        #leaderboard-btn {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-family: "Press Start 2P";
            background: #ff3e3e;
            border: none;
            color: white;
            border-radius: 2px;
            font-size: 18px;
            padding: 8px;
            cursor: pointer;
            pointer-events: all;
        }

        #leaderboard-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 1300px;
            height: 804px;
            border: 2px solid white;
            background: rgba(0, 0, 0, 0.95);
            font-family: "Press Start 2P";
            display: none;
            z-index: 20;
        }

        .leaderboard-section {
            flex: 1;
            padding: 32px;
            color: white;
        }

        .leaderboard-section h2 {
            text-align: center;
            margin-bottom: 32px;
            font-size: 24px;
        }

        .score-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .rank {
            font-size: 24px;
            width: 40px;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-info img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        .player-info a {
            color: #ff3e3e;
            text-decoration: none;
        }

        .player-info a:hover {
            text-decoration: underline;
        }

        .score {
            margin-left: auto;
            font-size: 20px;
        }

        .modal-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            font-family: "Press Start 2P";
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
        }

        .close-button:hover {
            color: #ff3e3e;
        }

        .sound-controls {
            width: 1300px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            justify-content: flex-start;
            bottom: 40px;
            gap: 16px;
        }

        .switch-container {
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: "Press Start 2P";
            color: white;
            font-size: 12px;
            height: 24px;
        }

        .switch {
            width: 48px;
            height: 24px;
            background: #333;
            border: 2px solid white;
            cursor: pointer;
            position: relative;
        }

        .switch-knob {
            width: 20px;
            height: 20px;
            background: white;
            position: absolute;
            transition: left 0.2s;
        }

        .switch[data-on="true"] .switch-knob {
            left: 26px;
            background: #50cb13;
        }

        .switch[data-on="false"] .switch-knob {
            left: 2px;
            background: #ff3e3e;
        }

        .game-wrapper {
            position: relative;
            width: fit-content;
            height: fit-content;
        }

        @media (min-width: 1350px) {
            #normal-message {
            margin-top: 16px;
            color: white;
            font-size: 12px;
            text-align: center;
            }
        }

        @media (max-width: 1350px) and (min-height: 600px) {
            .canvas-container {
            width: 80vw; /* responsive width */
            height: auto; /* maintain aspect ratio */
            }

            canvas {
            width: 100%; /* fill container */
            height: auto; /* maintain aspect ratio */
            }

            /* header should match canvas width */
            #game-header {
            width: 80vw; /* match canvas container */
            left: 50%;
            transform: translateX(-50%); /* center it */
            }

            /* sound controls should also match */
            .sound-controls {
            width: 80vw;
            left: 50%;
            transform: translateX(-50%);
            }

            /* modals should scale with viewport */
            #submit-modal,
            #leaderboard-modal {
            width: 80vw;
            height: auto;
            aspect-ratio: 1300/800; /* maintain game aspect ratio */
            }

            #textCanvas {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 40%;
            height: 20%;
            background-color: transparent;
            background: transparent;
            border: none;
            box-shadow: none;
            pointer-events: none;
            outline: none;
            }

            #startTextCanvas {
            position: absolute;
            top: 40%;
            right: 2px;
            width: 40%;
            height: 20%;
            background-color: transparent;
            background: transparent;
            border: none;
            box-shadow: none;
            pointer-events: none;
            outline: none;
            }

            .title {
            font-size: 2vw; /* from 36px */
            }

            .credit {
            font-size: 1vw; /* from 14px */
            }

            #leaderboard-btn {
            font-size: 1.2vw; /* from 18px */
            padding: 0.5vw; /* smaller padding for compact look */
            }

            /* Sound controls */
            .switch-container {
            font-size: 0.9vw; /* from 12px */
            height: 20px; /* fixed height works better for switches */
            }

            .switch {
            width: 36px; /* slightly smaller but fixed size */
            height: 18px; /* to maintain usability */
            }

            .switch-knob {
            width: 14px;
            height: 14px;
            }

            /* Controls text */
            #controls {
            font-size: 1vw; /* from 15px */
            }

            #submit-modal {
            width: 80vw;
            height: calc(100vw * 800 / 1300); /* maintain aspect ratio */
            padding: 5px;
            box-sizing: border-box;
            }

            #leaderboard-modal {
            width: 80vw;
            height: calc(80vw * 800 / 1300); /* maintain aspect ratio */
            padding: 5px;
            box-sizing: border-box;
            }

            /* Scale modal content */
            .score-label {
            font-size: calc(32px * 0.8);
            }

            .score-value {
            font-size: calc(60px * 0.8);
            }

            #username-input {
            width: 60%;
            font-size: calc(16px * 0.8);
            padding: 8px;
            }

            .button-container {
            width: 60%;
            }

            .modal-btn {
            font-size: calc(14px * 0.8);
            padding: 8px;
            }

            .leaderboard-section {
            padding-top: 16px;
            }

            /* Leaderboard content scaling */
            .leaderboard-section h2 {
            font-size: 2vw;
            margin-bottom: 12px;
            }

            .rank {
            font-size: 1vw;
            width: 20px;
            }

            .player-info {
            gap: 1vw; /* reduced gap */
            }

            .player-info img {
            width: 1vw;
            height: 1vw;
            }

            .player-info a {
            font-size: 1vw;
            }

            .score {
            font-size: 1vw;
            }

            .close-button {
            font-size: 18px;
            padding: 6px;
            }

            .switch[data-on="true"] .switch-knob {
            left: 20px;
            background: #50cb13;
            }
        }

        @media (max-height: 600px) and (orientation: landscape) {
            body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            }

            .game-wrapper {
            width: auto;
            height: 100vh;
            position: relative;
            }

            .canvas-container {
            width: auto;
            height: 100vh;
            position: relative;
            }

            canvas {
            height: 100vh;
            width: auto;
            }

            #textCanvas {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 40%;
            height: 20%;
            background-color: transparent;
            background: transparent;
            border: none;
            box-shadow: none;
            pointer-events: none;
            outline: none;
            }

            #startTextCanvas {
            position: absolute;
            top: 40%;
            right: 2px;
            width: 40%;
            height: 20%;
            background-color: transparent;
            background: transparent;
            border: none;
            box-shadow: none;
            pointer-events: none;
            outline: none;
            }

            /* hide header elements in landscape */
            #game-header {
            display: none;
            }

            /* reposition sound controls */
            .sound-controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            transform: none;
            width: auto;
            }

            /* reposition controls text */
            #controls {
            display: none;
            }

            .switch-container {
            font-size: 8px; /* smaller font for "sfx" and "music" text */
            gap: 4px; /* reduced gap between text and switch */
            height: 16px; /* reduced overall height */
            }

            .switch {
            width: 32px; /* smaller switch width */
            height: 16px; /* smaller switch height */
            border: 1px solid white; /* thinner border */
            }

            .switch-knob {
            width: 12px; /* smaller knob */
            height: 12px;
            top: 1px; /* center it vertically */
            }

            .switch[data-on="true"] .switch-knob {
            left: 18px; /* adjusted position for smaller switch */
            }

            .switch[data-on="false"] .switch-knob {
            left: 2px; /* adjusted position for smaller switch */
            }
        }

        @media (max-width: 600px) and (orientation: portrait) {
            .canvas-container {
            display: none;
            }

            .rotate-warning {
            display: flex !important;
            }

            .sound-controls {
            display: none;
            }

            .switch-container {
            display: none;
            }

            #controls {
            display: none;
            }

            .leaderboard-section {
            padding-top: 10px;
            }

            /* Leaderboard content scaling */
            .leaderboard-section h2 {
            font-size: 1vw;
            margin-bottom: 10px;
            }

            .rank {
            font-size: 1vw;
            width: 5px;
            }

            .player-info {
            gap: 5px; /* reduced gap */
            }

            .player-info img {
            width: 0.5vw;
            height: 0.5vw;
            }

            .player-info a {
            font-size: 1vw;
            }

            .score {
            font-size: 1vw;
            }

            .score-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
            }

            .close-button {
            font-size: 10px;
            padding: 3px;
            }

            .switch[data-on="true"] .switch-knob {
            left: 18px; /* adjusted position for smaller switch */
            }

            .switch[data-on="false"] .switch-knob {
            left: 2px; /* adjusted position for smaller switch */
            }
        }

        @media (max-width: 600px) {
            /* Portrait mode */
            /* @media (orientation: portrait) {
                #leaderboard-modal {
                    display: block;
                    width: 90vw;
                    height: 80vh;
                    font-size: 14px;
                    display: none;
                }
                } */

            /* Landscape mode */
            @media (orientation: landscape) {
            #leaderboard-modal {
                display: none !important;
            }

            #leaderboard-btn {
                display: none;
            }
            }
        }

        .rotate-warning {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 15;
        }

        .warning-content {
            text-align: center;
            font-family: "Press Start 2P";
            color: white;
        }

        .warning-text {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .warning-icon {
            font-size: 48px;
            animation: rotate 2s infinite linear;
        }

        @keyframes rotate {
            from {
            transform: rotate(0deg);
            }
            to {
            transform: rotate(360deg);
            }
        }
        </style>
    </head>
    <body>
        <div class="game-wrapper">
        <div class="canvas-container">
            <canvas id="canvas" oncontextmenu="event.preventDefault()"></canvas>
            <canvas id="textCanvas"></canvas>
            <canvas id="startTextCanvas"></canvas>
        </div>
        <div class="rotate-warning" style="display: none">
            <div class="warning-content">
            <div class="warning-text">Please rotate your device</div>
            <div class="warning-icon">↻</div>
            </div>
        </div>
        <div class="sound-controls">
            <div class="switch-container">
            <span>sfx</span>
            <div class="switch" data-on="true" id="sfx-switch">
                <div class="switch-knob"></div>
            </div>
            </div>
            <div class="switch-container">
            <span>music</span>
            <div class="switch" data-on="true" id="music-switch">
                <div class="switch-knob"></div>
            </div>
            </div>
        </div>
        </div>
        <div id="game-header">
        <div class="title">f22raptor</div>
        <button class="leaderboard-btn" id="leaderboard-btn">leaderboard</button>
        <div class="credit">
            made by <a href="https://x.com/moneyrudh" target="_blank">bluedot</a>
        </div>
        </div>
        <div id="submit-modal" class="hidden">
        <div class="score-display">
            <div class="score-label">SCORE</div>
            <div class="score-value">0</div>
        </div>
        <input
            type="text"
            id="username-input"
            placeholder="Enter X username"
            autocomplete="off"
            spellcheck="false"
        />
        <div class="button-container">
            <button class="modal-btn no-btn">NO</button>
            <button class="modal-btn submit-btn">SUBMIT</button>
        </div>
        <div id="success-message" class="hidden"></div>
        <div id="error-message" class="hidden"></div>
        <div id="normal-message">escape to restart</div>
        </div>
        <div id="leaderboard-modal">
        <button class="close-button">×</button>
        <div class="leaderboard-section">
            <h2>ALL TIME</h2>
            <div id="alltime-scores"></div>
        </div>
        <div class="leaderboard-section">
            <h2>DAILY</h2>
            <div id="daily-scores"></div>
        </div>
        </div>
        <div id="controls">hold space / up - thrust</div>
        <script>
        // Add this right after your Module declaration, before the canvas setup
        let audioContext = null;
        let audioInitialized = false;

        function initAudioContext() {
            if (audioInitialized) return;
            
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)({
                  sampleRate: 44100,
                  latencyHint: 'interactive',
                });
                
                if (audioContext.state === 'suspended' && /iPhone|iPad|iPod|Safari/i.test(navigator.userAgent)) {
                    const resumeAudio = async () => {
                        await audioContext.resume();
                        
                        // Remove the event listeners once audio is unlocked
                        ['touchstart', 'touchend', 'mousedown', 'keydown'].forEach(event => {
                            document.body.removeEventListener(event, resumeAudio);
                        });
                    };
                    
                    ['touchstart', 'touchend', 'mousedown', 'keydown'].forEach(event => {
                        document.body.addEventListener(event, resumeAudio);
                    });
                }
                
                // Create and play a silent buffer to unlock audio
                const silentBuffer = audioContext.createBuffer(1, 1, 22050);
                const source = audioContext.createBufferSource();
                source.buffer = silentBuffer;
                source.connect(audioContext.destination);
                source.start();
                
                audioInitialized = true;
                Module.audioContext = audioContext;
            } catch (e) {
                console.error('Audio init failed:', e);
            }
        }
        var Module = {
            canvas: (function () {
                var canvas = document.getElementById("canvas");
                canvas.addEventListener(
                    "webglcontextlost",
                    function (e) {
                    e.preventDefault();
                    },
                    false
                );
                canvas.addEventListener("click", function() {
                    if (!audioInitialized) {
                        initAudioContext();
                    }
                }, false);

                // Also add touch handler for mobile
                canvas.addEventListener("touchstart", function() {
                    if (!audioInitialized) {
                        initAudioContext();
                    }
                    }, false);
                return canvas;
            })(),
            onRuntimeInitialized: function () {
            const modal = document.getElementById("submit-modal");
            const usernameInput = document.getElementById("username-input");

            const submitBtn = document.querySelector(".submit-btn");
            const noBtn = document.querySelector(".no-btn");
            const leaderboardBtn = document.querySelector(".leaderboard-btn");

            const remoteUrl = "https://f22-server.vercel.app";
            const localUrl = "http://localhost:3000";
            const serverUrl = localUrl;

            let state = 0;
            let finalScore = 0;
            let inputValue = "";
            let allTimeScores = undefined;
            let dailyScores = undefined;
            let secureData = {};

            modal.classList.add("hidden");

            usernameInput.value = "";
            usernameInput.disabled = true;

            function restartGame() {
                Module._game_state_reset_main();
                
                // hide the modal
                modal.classList.add("hidden");
                
                // re-enable canvas interaction
                document.getElementById("canvas").style.pointerEvents = "auto";
                
                // reset game state in JS
                state = 0;
                score = 0;
                gameStarted = false;
                
                // show start text again
                startTextCanvas.style.display = "block";
                Module.setGameState(0);
            }

            const keyHandler = (e) => {
                if (state == 0) return;
                e.preventDefault();

                if (e.key === "Backspace") {
                    inputValue = inputValue.slice(0, -1);
                    usernameInput.value = inputValue;
                    return;
                }

                if (e.key === "Escape") {
                    restartGame();
                    return;
                }

                if (/^[a-zA-Z0-9_]$/.test(e.key) && inputValue.length < 15) {
                    inputValue += e.key;
                    usernameInput.value = inputValue;
                }
            };

            // Handle No button
            noBtn.addEventListener("click", () => {
                // location.reload();
                restartGame();
            });

            document.addEventListener("keydown", keyHandler);

            leaderboardBtn.addEventListener("click", async () => {
                const modal = document.getElementById("leaderboard-modal");
                if (modal.style.display === "flex") return; // prevent multiple opens
                leaderboardBtn.disabled = true;
                modal.style.display = "flex";

                document.querySelector(".close-button").onclick = () => {
                modal.style.display = "none";
                leaderboardBtn.disabled = false;
                };

                if (allTimeScores === undefined || dailyScores === undefined) {
                // fetch both leaderboards
                const [allTime, daily] = await Promise.all([
                    fetch(`${serverUrl}/all_time`).then((r) =>
                    r.json()
                    ),
                    fetch(`${serverUrl}/get_daily`).then((r) =>
                    r.json()
                    ),
                ]);
                allTimeScores = allTime;
                dailyScores = daily;
                }

                const getRankStyle = (index) => {
                switch (index) {
                    case 0:
                    return "color: #FFD700"; // gold
                    case 1:
                    return "color: #FAFAFA"; // silver
                    case 2:
                    return "color: #CD7F32"; // bronze
                    default:
                    return "color: #C0C0C0";
                }
                };

                const renderScores = (scores, containerId) => {
                const html = scores
                    .map(
                    (score, i) => `
                        <div class="score-row">
                            <div class="rank" style="${getRankStyle(i)}">${i + 1}</div>
                            <div class="player-info">
                                <img src="${score.profile_image || "/placeholder.png"}" alt="">
                                <a href="${score.profile_url}" target="_blank" style="${getRankStyle(i)}">@${score.username}</a>
                            </div>
                            <div class="score" style="${getRankStyle(i)}">${Math.floor(score.score)}</div>
                        </div>
                    `)
                    .join("");
                document.getElementById(containerId).innerHTML = html;
                };

                renderScores(allTimeScores, "alltime-scores");
                renderScores(dailyScores, "daily-scores");
                leaderboardBtn.disabled = true;
            });
            // Handle Submit button
            submitBtn.addEventListener("click", async () => {
                submitBtn.disabled = true;
                noBtn.disabled = true;
                const username = usernameInput.value.trim();
                const errorMsg = document.getElementById("error-message");
                errorMsg.classList.add("hidden");

                if (username === undefined || username === "") {
                errorMsg.textContent = "enter a username";
                errorMsg.classList.remove("hidden");
                submitBtn.disabled = false;
                noBtn.disabled = false;
                return;
                }

                try {
                // First verify the user exists
                const verifyRes = await fetch(
                    `${serverUrl}/verify/${username.toString()}`
                );
                const verifyData = await verifyRes.json();

                if (!verifyData.valid) {
                    errorMsg.textContent = "user not found, typo?";
                    errorMsg.classList.remove("hidden");
                    submitBtn.disabled = false;
                    noBtn.disabled = false;
                    return;
                }

                // If verified, submit the score
                const submitRes = await fetch(
                    `${serverUrl}/submission`,
                    {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            username,
                            score: secureData.score,
                            timestamp: secureData.timestamp,
                            signature: secureData.signature
                        }),
                    }
                );

                if (!submitRes.ok) {
                    const error = await submitRes.json();
                    errorMsg.textContent = error.error || "Failed to submit score";
                    errorMsg.classList.remove("hidden");
                    usernameInput.value = "";
                    submitBtn.disabled = false;
                    noBtn.disabled = false;
                    return;
                }

                const submitData = await submitRes.json();
                const buttonsContainer =
                    document.querySelector(".button-container");
                const successMsg = document.getElementById("success-message");

                buttonsContainer
                    .querySelectorAll("button")
                    .forEach((btn) => (btn.style.display = "none"));
                successMsg.textContent = `submitted (${submitData.submitCount}/3)`;
                successMsg.classList.remove("hidden");
                usernameInput.value = "";

                // Success! Reload the game
                document.getElementById("canvas").style.pointerEvents = "auto";
                document.removeEventListener("keydown", keyHandler);
                setTimeout(() => {
                    location.reload();
                }, 1500);
                } catch (err) {
                console.error("Submit error:", err);
                errorMsg.textContent = "Something went wrong - try again?";
                errorMsg.classList.remove("hidden");
                submitBtn.disabled = false;
                noBtn.disabled = false;
                }
            });
            const gameCanvas = document.getElementById("canvas");
            const textCanvas = document.getElementById("textCanvas");
            const startTextCanvas = document.getElementById("startTextCanvas");
            let gameStarted = false;
            let score = 0;

            // match text canvas size to game canvas
            textCanvas.width = gameCanvas.width * 2;
            textCanvas.height = gameCanvas.height;
            startTextCanvas.width = gameCanvas.width * 2;
            startTextCanvas.height = gameCanvas.height;

            gameCanvas.addEventListener("resize", (event) => {
                textCanvas.width = gameCanvas.width * 2;
                textCanvas.height = gameCanvas.height;
                startTextCanvas.width = gameCanvas.width * 2;
                startTextCanvas.height = gameCanvas.height;
            });

            const scoreCtx = textCanvas.getContext("2d");
            const startCtx = startTextCanvas.getContext("2d");
            scoreCtx.imageSmoothingEnabled = false;
            startCtx.imageSmoothingEnabled = false;

            Module.setGameState = function (state) {
                console.log("CALLED SET GAME STATE");
                if (state === 1) {
                startTextCanvas.style.display = "none";
                gameStarted = true;
                } else {
                startTextCanvas.style.display = "block";
                }
            };

            Module.updateScore = function (_score) {
                score = _score;
            };

            Module.showGameOver = function (score, timestamp, signature) {
                console.log("Game over with validated score:", score);
                finalScore = score;  // we keep this for display
                secureData = {
                    score: score,
                    timestamp: timestamp,
                    signature: signature
                };
                modal.classList.remove("hidden");
                document.querySelector(".score-value").textContent = score;
                document.getElementById("canvas").style.pointerEvents = "none";
                usernameInput.value = "";
                usernameInput.disabled = false;
                setTimeout(() => {
                    usernameInput.focus();
                    state = 1;
                }, 100);
            };

            // Module.showGameOver = function (_score) {
            //     console.log("SETTING FINAL SCORE AS:", _score);
            //     finalScore = parseInt(_score);
            //     modal.classList.remove("hidden");
            //     document.querySelector(".score-value").textContent = finalScore;
            //     document.getElementById("canvas").style.pointerEvents = "none";
            //     usernameInput.value = "";
            //     usernameInput.disabled = false;
            //     startTextCanvas.style.display = "block";
            //     setTimeout(() => {
            //     usernameInput.focus();
            //     state = 1;
            //     }, 100);
            // };

            function drawScore() {
                scoreCtx.clearRect(0, 0, textCanvas.width, textCanvas.height);
                scoreCtx.font = '24px "Press Start 2P"';
                scoreCtx.fillStyle = "white";
                scoreCtx.textAlign = "right";
                scoreCtx.textBaseline = "middle"; // vertical center

                // center both horizontally and vertically
                scoreCtx.fillText(
                `SCORE: ${Math.floor(score)}`,
                textCanvas.width - 40, // horizontal center
                textCanvas.height / 2 // vertical center
                );
                requestAnimationFrame(drawScore);
            }

            function drawStartText() {
                startCtx.clearRect(
                0,
                0,
                startTextCanvas.width,
                startTextCanvas.height
                );
                startCtx.font = '24px "Press Start 2P"';
                startCtx.fillStyle = "white";
                startCtx.textAlign = "right";
                startCtx.textBaseline = "middle";

                startCtx.fillText(
                "CLICK TO START",
                startTextCanvas.width - 40,
                startTextCanvas.height / 2
                );
                requestAnimationFrame(drawStartText);
            }

            drawScore();
            if (!gameStarted) drawStartText();
            document.getElementById("controls").click();

            // add this inside Module.onRuntimeInitialized
            const sfxSwitch = document.getElementById("sfx-switch");
            const musicSwitch = document.getElementById("music-switch");

            [sfxSwitch, musicSwitch].forEach((switchEl) => {
                switchEl.addEventListener("click", () => {
                const isOn = switchEl.dataset.on === "true";
                switchEl.dataset.on = (!isOn).toString();

                if (!audioInitialized) {
                    initAudioContext();
                }

                if (switchEl.id === "sfx-switch") {
                    Module._setSFXVolume(isOn ? 0 : 75);
                } else {
                    Module._setMusicVolume(isOn ? 0 : 50);
                    if (!isOn && typeof Module._playRandom === 'function') {
                        Module._playRandom();
                    }
                }
                });
            });

            document.querySelector(".sound-controls").style.display = "flex";

            ['click', 'touchstart', 'touchend', 'mousedown', 'keydown'].forEach(event => {
            document.addEventListener(event, function() {
                if (!audioInitialized) {
                initAudioContext();
                }
            }, {once: true});  // important: only need first interaction
            });
            },
        };
        </script>
        <script async type="text/javascript" src="f22_raptor.js"></script>
    </body>
    </html>
